<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <script type="text/javascript" src="/_ah/channel/jsapi"></script>
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
  <title>Dinger</title>
</head>

<body>
  <h1 id="name"></h1>

  <form id="ding" name="ding" action="#">
    <input type="text" id="dingMessage"> <input type="submit">
  </form>

  <ul id="messages"></ul>

  <script type="text/javascript">
    $('#ding').submit(function(event) {
      event.preventDefault();
      $.post('{{{@}}}', $('#dingMessage').val());
    });

    $.getJSON('{{{@}}}/info', function(data) {
      $('#name').text(data.Name);
    });

    $.getJSON('{{{@}}}/connect', function(data) {
      var chan = new goog.appengine.Channel(data.Token)
      chan.open({
	onopen: function() { },
	onclose: function() { },
        onmessage: function(message) {
          $('<li><\/li>').text(message.data).prependTo('#messages');
          console.log(message.data)
        },
      })
    });
  </script>
</body>
</html>
